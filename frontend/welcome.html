<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pokémon Academy — Welcome</title>
  <style>
    body{font-family:sans-serif;background:#87CEEB;margin:0;padding:40px}
    .title{font-size:36px;color:#fff;text-shadow:0 2px 0 rgba(0,0,0,0.15)}
    #statusArea{margin-top:16px}
    #statusDot{display:inline-block;width:14px;height:14px;border-radius:50%;background:#f00;margin-right:8px;vertical-align:middle}
    button.navigate{margin-top:20px;padding:8px 12px;border-radius:6px}
  </style>
</head>
<body>
  <h1 class="title">POKéMON ACADEMY</h1>
  <div id="statusArea">
    <span id="statusDot" data-test-id="welcome-status-dot" aria-hidden="true"></span>
    <span id="statusMsg" data-test-id="welcome-status-msg">PREPARING MISSION PARAMETERS...</span>
  </div>

  <div style="margin-top:24px">
    <button class="navigate" id="gotoCheckin" data-test-id="goto-checkin">Go to Check-In (Ctrl+Enter)</button>
  </div>

  <script>
    // deterministic navigation: wait for /api/scene/goto to confirm, then navigate after small delay
    async function gotoCheckin() {
      try {
        const res = await fetch('/api/scene/goto', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ to: 'CHECKIN' })
        });
        if (res.ok) {
          // small delay to allow backend & client state updates to settle for Playwright
          await new Promise(r => setTimeout(r, 150));
          location.href = '/checkin.html';
        } else {
          console.error('scene goto failed', res.status);
        }
      } catch (e) { console.error(e); }
    }

    document.getElementById('gotoCheckin').addEventListener('click', gotoCheckin);
    document.addEventListener('keydown', e => { if (e.ctrlKey && e.key === 'Enter') gotoCheckin(); });

    (async () => {
      try {
        const r = await fetch('/api/health');
        if (r.ok) {
          document.getElementById('statusDot').style.background = '#0c0';
          document.getElementById('statusMsg').textContent = 'READY';
        } else {
          document.getElementById('statusDot').style.background = '#f00';
          document.getElementById('statusMsg').textContent = 'NOT READY';
        }
      } catch(e) {
        document.getElementById('statusDot').style.background = '#f00';
        document.getElementById('statusMsg').textContent = 'OFFLINE';
      }
    })();
  </script>
</body>
</html>